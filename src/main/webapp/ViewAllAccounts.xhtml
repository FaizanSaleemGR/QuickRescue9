<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
>
<h:head>
	<title>View All Accounts :: Quick Rescue</title>
	<meta name="author" content="Faizan Saleem"></meta>
</h:head>

<f:metadata>
	<f:viewAction action="#{errorController.checkForPageAccess}"/>
</f:metadata>

<h:body>

	<ui:insert name="header">
		<ui:include src="WEB-INF/templates/common/commonHeader.xhtml" />
	</ui:insert>

	<!-- Add New Account Modal  -->
	<b:modal id="AddNewAccountModal" title="Add New Account"
		styleClass="modalPseudoClass"
	>
		<b:form id="addAccountForm">
			<b:panel title="Add New Account" look="primary">
				<b:row>
					<b:column>
						<b:inputText placeholder="Account Name" id="newAccountName"
							value="#{accountController.newAccount.name}" autocomplete="false"
						>
							<f:facet name="prepend">
								<b:icon name="user" />
							</f:facet>
							
							
							<f:validator validatorId="EmptyFieldValidator"/>
  							<f:validator validatorId="AccountNameValidator" />  
							
							<f:attribute name="accountList" value="#{accountController.accountsList}" />
							<f:ajax event="change" render="@form" execute="@form" />
						</b:inputText>
						
						<b:message id="newAccountNameValidationMessage" for="newAccountName" />
						
					</b:column>
				</b:row>

				<b:row>
					<b:column>
						<b:inputText placeholder="Email Domain" id="newAccountEmailDomain"
							value="#{accountController.newAccount.emailDomain}"
							autocomplete="false"
						>
							<f:facet name="prepend">
								<b:iconAwesome name="envelope" />
							</f:facet>
							
							<f:validator validatorId="EmptyFieldValidator"/>
  							<f:validator validatorId="AccountEmailDomainValidator" />  
							
							<f:attribute name="accountList" value="#{accountController.accountsList}" />
							<f:ajax event="change" render="@form" execute="@form" />
							
						</b:inputText>
						
						
						<b:message id="newAccountEmailDomainValidationMessage" for="newAccountEmailDomain" />
						
					</b:column>
				</b:row>



				<b:row>
					<b:column>
						<b:inputText placeholder="Time Zone City"
							id="newAccountTimeZoneCity"
							value="#{accountController.newAccount.timeZoneCity}"
							autocomplete="false"
						>
							<f:facet name="prepend">
								<b:iconAwesome name="clock-o" />
							</f:facet>
						</b:inputText>
					</b:column>
				</b:row>





			</b:panel>







			<b:panel title="Add Account Contract" look="info">

				<b:row>
					<b:column>
						<b:dateTimePicker
							value="#{accountController.accountContract.startDate}"
							allow-input-toggle="true" show-date="true" show-icon="true"
							use-current="true" label="Start Date" id="contractStartDate"
							 validator="EmptyFieldValidator">
							 
							 
							 <f:ajax event="change" render="@form" execute="@form" />
							 </b:dateTimePicker>
						
						<b:message id="contractStartDateValidationMessage" for="contractStartDate" />
						
					</b:column>
				</b:row>

				<b:row>
					<b:column>
						<b:dateTimePicker
							value="#{accountController.accountContract.endDate}"
							allow-input-toggle="true" show-date="true" show-icon="true"
							use-current="true" label="End Date" id="contractEndDate"
							 validator="EmptyFieldValidator"
						>
						<f:ajax event="change" render="@form" execute="@form" />
						</b:dateTimePicker>
						<b:message id="contractEndDateValidationMessage" for="contractEndDate" />
					</b:column>
				</b:row>

				<b:row>
					<b:column>

						<b:inputText type="number" label="Contacts Limit"
							value="#{accountController.accountContract.contactsLimit}"
							min="0" id="contractContactsLimit" validator="EmptyFieldValidator"
						>
						
						<f:ajax event="change" render="@form" execute="@form" />
						
						</b:inputText>
								<b:message id="contractContactsLimitValidationMessage" for="contractContactsLimit" />
					</b:column>
				</b:row>

				<b:row>
					<b:column>
						<b:inputText type="number" label="Logins Limit"
							value="#{accountController.accountContract.loginsLimit}" min="0"
							id="contractLoginsLimit" validator="EmptyFieldValidator"
						>
						
						<f:ajax event="change" render="@form" execute="@form" />
						</b:inputText>
						
						<b:message id="contractLoginsLimitValidationMessage" for="contractLoginsLimit" />
					</b:column>
				</b:row>

			</b:panel>


			<b:row>
				<b:column>
					<b:commandButton value="Add New Account"
						action="#{accountController.addAccount()}" look="success"
						style="width:100%"
						disabled="#{not facesContext.postback or facesContext.validationFailed}"
					/>
				</b:column>
			</b:row>



		</b:form>
	</b:modal>
	<b:modal id="AddNewContractModal" title="Add New Contract"
		styleClass="modalPseudoClass"
	>
		<b:form id="addContractForm">
			<b:panel title="Add New Contract" look="info">

				<b:row>
					<b:column>
						<b:dateTimePicker
							value="#{accountController.accountContract.startDate}"
							allow-input-toggle="true" show-date="true" show-icon="true"
							use-current="true" label="Start Date" id="newContractStartDate"
							validator="EmptyFieldValidator"
						>
						
						 <f:ajax event="change" render="@form" execute="@form" />
						
						</b:dateTimePicker>
						
						<b:message id="newContractStartDateValidationMessage" for="newContractStartDate" />
						
					</b:column>
				</b:row>

				<b:row>
					<b:column>
						<b:dateTimePicker
							value="#{accountController.accountContract.endDate}"
							allow-input-toggle="true" show-date="true" show-icon="true"
							use-current="true" label="End Date" id="newContractEndDate"
							validator="EmptyFieldValidator"
						>
						<f:ajax event="change" render="@form" execute="@form" />
						</b:dateTimePicker>
						
						<b:message id="newContractEndDateValidationMessage" for="newContractEndDate" />
					</b:column>
				</b:row>

				<b:row>
					<b:column>

						<b:inputText type="number" label="Contacts Limit"
							value="#{accountController.accountContract.contactsLimit}"
							min="0" id="newContractContactsLimit"
							validator="EmptyFieldValidator"
						>
						
						<f:ajax event="change" render="@form" execute="@form" />
						</b:inputText>

						<b:message id="newContractContactsLimitValidationMessage" for="newContractContactsLimit" />
					</b:column>
				</b:row>

				<b:row>
					<b:column>
						<b:inputText type="number" label="Logins Limit"
							value="#{accountController.accountContract.loginsLimit}" min="0" id="newContractLoginsLimit"
							validator="EmptyFieldValidator"
						>
						
						<f:ajax event="change" render="@form" execute="@form" />
						</b:inputText>
						
						<b:message id="newContractLoginsLimitValidationMessage" for="newContractLoginsLimit" />
						
					</b:column>
				</b:row>


				<b:row>
					<b:column>

						<b:selectOneMenu
							value="#{accountController.accountIdForNewContract}"
							label="Select an Account"
						>
							<f:selectItems
								value="#{accountController.accountsNamesList.entrySet()}"
								var="entry" itemValue="#{entry.key}"
								itemLabel="#{entry.key} - #{entry.value}"
							/>
						</b:selectOneMenu>
					</b:column>
				</b:row>


			</b:panel>


			<b:row>
				<b:column>
					<b:commandButton value="Add New Contract"
						action="#{accountController.addNewContract()}" look="success"
						style="width:100%"
						disabled="#{not facesContext.postback or facesContext.validationFailed}"
					/>
				</b:column>
			</b:row>



		</b:form>
	</b:modal>


	<b:container fluid="true">

		<b:form style="padding-top:25px">
			<b:commandButton value="Log Out" look="danger"
				action="#{utilsController.logout()}" style="float:right;"
			/>
			<b:tabView pills="true"
				contentStyle="border: 1px solid #ddd; padding:10px"
			>
				<b:tab title="All Accounts">

					<b:row>
						<b:column>
							<button id="btrigger" style="float: right"
								class="btn btn-success btn-sm" data-target="#AddNewAccountModal"
								data-toggle="modal" type="button"
							>Add New Account</button>
						</b:column>
					</b:row>

					<h:panelGroup id="accountsListDT">
						<b:dataTable value="#{accountController.accountsList}"
							var="account" page-length="5" page-length-menu="5,10,20"
							id="editableAccountTable" class="editableAccountTable"
						>

							<b:dataTableColumn value="#{account.accountId}" label="ID"
								order="asc"
							/>
							<b:dataTableColumn label="Name">
								<b:inputText value="#{account.name}"
									rendered="#{account.editable}"
								/>
								<h:outputText value="#{account.name}"
									rendered="#{not account.editable}"
								/>
							</b:dataTableColumn>

							<b:dataTableColumn label="Email Domain">

								<b:inputText value="#{account.emailDomain}"
									rendered="#{account.editable}"
								>
									<f:facet name="prepend">
										<h:outputText value="@" />
									</f:facet>
								</b:inputText>

								<h:outputText value="#{account.emailDomain}"
									rendered="#{not account.editable}"
								/>
							</b:dataTableColumn>

							<b:dataTableColumn label="Time Zone City">
								<b:inputText value="#{account.timeZoneCity}"
									rendered="#{account.editable}"
								/>
								<h:outputText value="#{account.timeZoneCity}"
									rendered="#{not account.editable}"
								/>
							</b:dataTableColumn>

							<b:dataTableColumn label="Contacts">
								<a
									href="#{request.contextPath}/ViewContacts.xhtml?accountId=#{account.accountId}"
									target="_blank" class="btn btn-primary btn-small"
								>View Contacts</a>
							</b:dataTableColumn>
							
							
							<b:dataTableColumn label="Contract Id">
							
							<h:outputText value="#{account.accountContract.contractId}" />
							
							</b:dataTableColumn>


							<b:dataTableColumn label="">


							
								
								<b:icon name="remove-sign" size="lg" ajax="true"
									update="@(.editableAccountTable)"
									onclick="ajax:accountController.deleteAccount(account.accountId)"
								/>

								<b:icon name="edit" size="lg" ajax="true"
									update="@(.editableAccountTable)"
									onclick="ajax:accountController.accountEditAction(account)"
								/>

							</b:dataTableColumn>








						</b:dataTable>
					</h:panelGroup>



				</b:tab>

				<b:tab title="All Contracts">

					<b:row>
						<b:column>
							<button id="btrigger" style="float: right"
								class="btn btn-warning btn-sm"
								data-target="#AddNewContractModal" data-toggle="modal" type="button"
							>Add New Contract</button>
						</b:column>
					</b:row>

					<h:panelGroup id="contractListDT">
						<b:dataTable value="#{accountController.contractsList}"
							class="editableContractTable" var="contract" page-length="5"
							page-length-menu="5,10,20"
						>
							<b:dataTableColumn value="#{contract.contractId}"
								label="Contract ID" order="asc"
							/>


							<b:dataTableColumn label="Start Date">

								<b:dateTimePicker value="#{contract.startDate}"
									allow-input-toggle="true" show-date="true" show-icon="true"
									use-current="true" rendered="#{contract.editable}"
								/>

								<h:outputText value="#{contract.startDate}"
									rendered="#{not contract.editable}"
								>
									<f:convertDateTime pattern="yyyy-MM-dd" />
								</h:outputText>


							</b:dataTableColumn>


							<b:dataTableColumn label="End Date">

								<b:dateTimePicker value="#{contract.endDate}"
									allow-input-toggle="true" show-date="true" show-icon="true"
									use-current="true" rendered="#{contract.editable}"
								/>

								<h:outputText value="#{contract.endDate}"
									rendered="#{not contract.editable}"
								>
									<f:convertDateTime pattern="yyyy-MM-dd" />
								</h:outputText>


							</b:dataTableColumn>

							<b:dataTableColumn label="Contacts Limit">

								<b:touchSpin value="#{contract.contactsLimit}"
									min="#{accountController.getCurrentNumberOfContactsOfAccount(contract.account)}"
									rendered="#{contract.editable}"
								/>

								<h:outputText value="#{contract.contactsLimit}"
									rendered="#{not contract.editable}"
								/>

							</b:dataTableColumn>

							<b:dataTableColumn label="Logins Limit">

								<b:touchSpin value="#{contract.loginsLimit}"
									min="#{accountController.getCurrentNumberOfLoginsOfAccount(contract.account)}"
									rendered="#{contract.editable}"
								/>

								<h:outputText value="#{contract.loginsLimit}"
									rendered="#{not contract.editable}"
								/>



							</b:dataTableColumn>

							<b:dataTableColumn label="Account">
								<h:outputText
									value="#{contract.account.name} (#{contract.account.accountId})"
								/>
							</b:dataTableColumn>

							<b:dataTableColumn label="Action">


								<b:icon name="edit" size="lg" ajax="true"
									update="@(.editableContractTable)"
									onclick="ajax:accountController.contractEditAction(contract)"
								/>
							</b:dataTableColumn>

						</b:dataTable>
					</h:panelGroup>



				</b:tab>
			</b:tabView>

		</b:form>
	</b:container>



</h:body>
</html>